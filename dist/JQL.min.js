/*!
 * JQL (JSON Query Language)
 * A simple intuitive JSON Query Language inspired by MySQL and jslinq made in javascript.
 * @version    : 0.1.0
 * @author     : DerianAndre
 * @repository : https://github.com/DerianAndre/JQL.git
 * @built      : 25/4/2021
 * @license    : MIT
 */
const d=!0,w=!1,y=!0,x=!1,t="~|~~|=|==|===|!=|!==|<|>|<=|>=",b="AND|&&|OR|[|]{2}",v=`(\\w+) (${t}) (([+-]?([0-9]*[.])?[0-9]+)|\\w+|\'.*\'|\".*\")`,E=`(?:${v})*(${b})*`;!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.JQL=e()}(this,function(){function h(t){if(!(t&&t instanceof Array))throw new Error("[JQL] Invalid array");return this.items=t,this.length=t.length,this.select=e,this.where=i,this.limit=n,this.group=s,this.array=r,this.data=r,this.result=r,this.count=u,this.first=a,this.last=f,this.log=m,this.table=g,this.dir=p,this}function l(t,e){let i,n=[];const s=new RegExp(v,"gm");for(;null!==(i=s.exec(t));)i.index===s.lastIndex&&s.lastIndex++,i.forEach((t,e)=>{n[e]=t});let r=n[1],o=n[2],l=n[3];if(!r||!o||!l)return!1;switch("null"==l&&(l=null),"true"==l&&(l=!0),"false"==l&&(l=!1),/^\d+$/.test(l)&&(l=parseInt(l)),/^\d.\d+$/.test(l)&&(l=parseFloat(l)),/^(\'.*\'|\".*\")$/.test(l)&&(l=String(l.slice(1,-1))),o){case"~":return e[r].toLowerCase().includes(l.toLowerCase());case"~~":return e[r].includes(l);case"=":case"==":return e[r]==l;case"===":return e[r]===l;case"!=":return e[r]!=l;case"!==":return e[r]!==l;case"<":return e[r]<l;case"<=":return e[r]<=l;case">":return e[r]>l;case">=":return e[r]>=l;default:return!1}}function o(t,e,i,n,s){var r="line-height: 1; padding: 10px 20px; font-size: 13px; color: white; background: #10151E url(https://derianandre.com/assets/projects/JQL/JQL-white.svg) no-repeat; background-position: 95% center; background-size: auto 12px;\tborder-radius: 15px;";e=`%c[JQL] ${e} (${"number"==typeof i?i:n.length} / ${n.length})\t\t`,t?console.groupCollapsed(e,r):console.group(e,r),s(),console.groupEnd()}function c(t){return"string"==typeof t?t.split(/[\s,]+/)?t.split(/[\s,]+/):[t]:t}function e(n){if(!n||"*"===n)return new h(this.items);if(n&&"string"!=typeof n&&"array"!=typeof n)throw new Error("[JQL] .select() is invalid");var s=[],r={},o={};n=c(n);for(let e=0,i=0;e<this.items.length;e++){var l=this.items[e];for(let t=0;t<n.length;t++){for(var u in l)u==n[t]&&(o[u]=this.items[e][u],r[i]={...o});t==n.length-1&&(s[i]=r[i],i++)}}return new h(s)}function i(e){if(!e)throw new Error("[JQL] .where() is invalid");let i=[],n;for(let t=0;t<this.items.length;t++)n="string"==typeof e?function(t,e){if(!t&&"string"!=typeof t||!e)throw new Error("[JQL] Invalid expression");let i=[],n,s=new RegExp(E,"gm");for(;n=s.exec(t);)n.index===s.lastIndex&&s.lastIndex++,n[0]&&i.push(n[0]);if(1==i.length)return l(i,e);let r=[],o=new RegExp(b,"gm");for(let t=0;t<i.length;t++)o.exec(i[t])||r.push(l(i[t],e));if(i.length%2==0)throw new Error(`[JQL] expression "${t}" is invalid`);switch(i[1]){case"&&":case"AND":return!r.includes(!1);case"||":case"OR":return!!r.includes(!0);default:return!1}}(e,this.items[t]):e(this.items[t]),n&&i.push(this.items[t]);return new h(i)}function n(t=!1){if(0==t||null==t)return new h(this.items);if(t&&t<0)throw new Error("Value must be greater or equals zero");for(var e=[],i=0;i<this.items.length;i++)e.push(this.items[i]);return new h(e.slice(0,t))}function s(i){if(!i)throw new Error("[JQL] .group() is invalid");let n=[];for(let t=0;t<this.items.length;t++){key="string"==typeof i?this.items[t][i]:i(this.items[t]);let e=null;for(let t=0;t<n.length;t++)if(function t(e,i){if(e===i||e==i)return!0;if(typeof e!=typeof i)return!1;if("object"!=typeof e)return e==i;for(var n in e){var s=e[n],n=i[n];if(!("object"==typeof s?t(s,n):s==n))return!1}return!0}(n[t].key,key)){e=n[t];break}e||(e={key:key,length:0,items:[]},n.push(e)),e.length++,e.items.push(this.items[t])}return new h(n)}function r(){return this.items}function u(){return this.length}function a(t=!0){return 0===this.length?null:t?this.items[0]:new h([this.items[0]])}function f(t=!0){return 0===this.length?null:t?this.items[this.length-1]:new h([this.items[this.length-1]])}function p(t={collapse:y,limit:x,items:d,options:!1}){let e=t.collapse,i=t.items,n=t.limit,s=t.options,r;r="boolean"==typeof i&&i?this.limit(n).items:this,o(e,"Dir  ",n,this,()=>{console.dir(r,s)})}function m(t={collapse:y,limit:x,items:d}){let e=t.collapse,i=t.items,n=t.limit,s;s=i?this.limit(n).items:this,o(e,"Log  ",n,this,()=>{console.log(s)})}function g(t={collapse:y,columns:w,limit:x}){let e=t.collapse,i=c(t.columns),n=t.limit;o(e,"Table",n,this,()=>{console.table(this.limit(n).items,i)})}return function(t){return new h(t)}});